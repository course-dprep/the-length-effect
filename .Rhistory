ncol(title.basics)
colnames(title.basics)
str(title.basics)
summary(title.basics)
head(title.basics, 10)
# Summary of title.ratings
dim(title.ratings)
nrow(title.ratings)
ncol(title.ratings)
colnames(title.ratings)
str(title.ratings)
summary(title.ratings)
head(title.ratings, 10)
# Complete summary title.basics & title.ratings
data_size_summary <- tibble::tibble(
dataset = c("title.basics","title.ratings"),
n_rows  = c(nrow(title.basics), nrow(title.ratings)),
n_cols  = c(ncol(title.basics), ncol(title.ratings)))
knitr::kable(summary_tb1, caption = "Data size summary") |>
kableExtra::kable_styling(full_width = FALSE,
bootstrap_options = c("striped","hover","condensed"))
# Complete summary title.basics & title.ratings
data_size_summary <- tibble::tibble(
dataset = c("title.basics","title.ratings"),
n_rows  = c(nrow(title.basics), nrow(title.ratings)),
n_cols  = c(ncol(title.basics), ncol(title.ratings)))
knitr::kable(data_size_summary, caption = "Data size summary") |>
kableExtra::kable_styling(full_width = FALSE,
bootstrap_options = c("striped","hover","condensed"))
# Checking variable type
dplyr::glimpse(title.basics[, c("primaryTitle", "startYear", "runtimeMinutes")])
sapply(title.basics[, c("primaryTitle", "startYear", "runtimeMinutes")], typeof)
dplyr::glimpse(title.ratings[, "averageRating", drop = FALSE])
sapply(title.ratings[, "averageRating", drop = FALSE], typeof)
# Replace "\N" and "" with NA
to_na <- function(x) {
y <- as.character(x)
y[y %in% c("\\N", "N", "")] <- NA_character_
y
}
# Cleaning the titile.basics dataset
title.basics_clean <- title.basics %>%
mutate(across(c(titleType, primaryTitle, startYear, runtimeMinutes), to_na)) %>%
mutate(startYear = suppressWarnings(as.integer(startYear)),
runtimeMinutes = suppressWarnings(as.numeric(runtimeMinutes))) %>%
select(tconst, titleType, primaryTitle, originalTitle, isAdult,
startYear, endYear, runtimeMinutes, genres) %>%
distinct(tconst, .keep_all = TRUE)
# Cleaning the title.ratings dataset
title.ratings_clean <- title.ratings %>%
mutate(across(c(averageRating, numVotes), to_na)) %>%
mutate(averageRating = as.numeric(averageRating),
numVotes = as.integer(numVotes)) %>%
select(tconst, averageRating, numVotes) %>%
distinct(tconst, .keep_all = TRUE)
# Replace "\N" and "" with NA
to_na <- function(x) {
y <- as.character(x)
y[y %in% c("\\N", "N", "")] <- NA_character_
y
}
# Cleaning the titile.basics dataset
title.basics_clean <- title.basics %>%
mutate(across(c(titleType, primaryTitle, startYear, runtimeMinutes), to_na)) %>%
mutate(startYear = suppressWarnings(as.integer(startYear)),
runtimeMinutes = suppressWarnings(as.numeric(runtimeMinutes))) %>%
select(tconst, titleType, primaryTitle, originalTitle, isAdult,
startYear, endYear, runtimeMinutes, genres) %>%
distinct(tconst, .keep_all = TRUE)
# Verification of variable types after the cleaning
dplyr::glimpse(title.basics_clean[, c("primaryTitle", "startYear", "runtimeMinutes")])
sapply(title.basics_clean[, c("primaryTitle", "startYear", "runtimeMinutes")], typeof)
dplyr::glimpse(title.ratings_clean[, "averageRating", drop = FALSE])
sapply(title.ratings_clean[, "averageRating", drop = FALSE], typeof)
# Checking missing values
colSums(is.na(title.basics_clean[, c("primaryTitle", "startYear", "runtimeMinutes")]))
colSums(is.na(title.ratings_clean[, c("averageRating", "numVotes")]))
# Variable table:
var_dict <- tribble(
~Variable,  ~Class, ~Definition, ~Role,
"runtimeMinutes", "numeric",  "Duration of the movie in minutes", "Independent variable",
"averageRating",  "numeric",   "Average IMDb user rating (0–10 scale, aggregated from user votes)", "Dependent variable",
"startYear",      "numeric",  "Year the movie was released", "Control variable")
var_dict %>%
gt() %>%
tab_header(title = "Table 1. Variable Explanation") %>%
tab_options(column_labels.font.weight = "bold")
### Checking for outliers in IMDb ratings
# Numeric summary of average ratings
summary(title.ratings_clean$averageRating)
# Histogram of rating distribution (excluding missing values)
ratings_clean <- dplyr::filter(title.ratings_clean, !is.na(averageRating))
ggplot(ratings_clean, aes(x = averageRating)) +
geom_histogram(binwidth = 0.25, color = "white", fill = "grey30", boundary = 0) +
scale_x_continuous(limits = c(0, 10), breaks = 0:10) +
labs(
x = "Average rating",
y = "Count",
title = "Distribution of IMDb Ratings"
) +
theme_minimal(base_size = 14)
View(title.basics_clean)
View(title.ratings_clean)
# Filter for movies only (and reasonable ranges)
title.basics_filtered <- title.basics_clean %>%
filter(titleType == "movie",
runtimeMinutes >0,
runtimeMinutes <= 300,
startYear <= 2025) %>%
select(tconst, primaryTitle, startYear, runtimeMinutes) %>%
distinct(tconst, .keep_all = TRUE)
View(title.basics_filtered)
# Renaming variables
rename(
title           = primaryTitle,
start_year      = startYear,
runtime_minutes = runtimeMinutes,
average_rating = averageRating
)
# Renaming variables
rename(
title           = primaryTitle,
start_year      = startYear,
runtime_minutes = runtimeMinutes,
average_rating = averageRating
)
# Renaming variables
title.basics_filtered <- title.basics_filtered %>%
rename(
title           = primaryTitle,
start_year      = startYear,
runtime_minutes = runtimeMinutes
)
title.ratings_clean <- title.ratings_clean %>%
rename(
average_rating  = averageRating,
votes           = numVotes
)
keys <- c("title", "start_year", "runtime_minutes")
sum(duplicated(select(title.basics_clean, all_of(keys))))
keys <- c("title", "start_year", "runtime_minutes")
sum(duplicated(select(title.basics_filtered, all_of(keys))))
# Merging datasets
merged_data <- title.basics_filtered %>%
select(tconst, runtime_minutes, start_year, title) %>%
mutate(
runtime_minutes = (as.numeric(runtime_minutes)),
start_year      = (as.integer(start_year)),
title = (as.character(title))) %>%
inner_join(
title.ratings_clean %>% select(tconst, average_rating, votes),
by = "tconst") %>%
mutate(
average_rating = as.numeric(average_rating),
votes= as.integer(votes))
descriptives <- tibble(
Variable = c("runtime_minutes","average_rating","start_year"),
N        = c(sum(!is.na(merged_data$runtime_minutes)),
sum(!is.na(merged_data$average_rating)),
sum(!is.na(merged_data$start_year))),
Missing  = c(sum(is.na(merged_data$runtime_minutes)),
sum(is.na(merged_data$average_rating)),
sum(is.na(merged_data$start_year))),
Mean     = c(mean(merged_data$runtime_minutes, na.rm = TRUE),
mean(merged_data$average_rating,  na.rm = TRUE),
mean(merged_data$start_year,      na.rm = TRUE)),
SD       = c(sd(merged_data$runtime_minutes, na.rm = TRUE),
sd(merged_data$average_rating,  na.rm = TRUE),
sd(merged_data$start_year,      na.rm = TRUE)),
Min      = c(min(merged_data$runtime_minutes, na.rm = TRUE),
min(merged_data$average_rating,  na.rm = TRUE),
min(merged_data$start_year,      na.rm = TRUE)),
Max      = c(max(merged_data$runtime_minutes, na.rm = TRUE),
max(merged_data$average_rating,  na.rm = TRUE),
max(merged_data$start_year,      na.rm = TRUE)))
descriptives %>%
gt() %>%
tab_header(title = "Table 2. Descriptive Statistics") %>%
tab_options(column_labels.font.weight="bold")
# Checking the duplicated data
# 2. Check duplicates among movies
keys <- c("title", "start_year", "runtime_minutes")
sum(duplicated(select(title.basics_filtered, all_of(keys))))
keys <- c("title", "start_year", "runtime_minutes")
movies_dup <- merged_data %>% as_tibble()
sum(duplicated(select(movies_dup, all_of(keys))) )
dups_rows <- movies_dup %>%
mutate(.is_dup = duplicated(select(., all_of(keys))) |
duplicated(select(., all_of(keys)), fromLast = TRUE)) %>%
filter(.is_dup) %>%
select(-.is_dup)
dup_groups <- movies_dup %>%
count(across(all_of(keys)), sort = TRUE) %>%
filter(n > 1)
dups_rows %>% slice_head(n = 80)
dup_groups %>% slice_head(n = 40)
### Checking for duplicates in merged data ----
# Define the keys for potential duplication
keys <- c("title", "start_year", "runtime_minutes")
# Count how many duplicate entries exist
dup_count <- sum(duplicated(select(merged_data, all_of(keys))))
dup_count
# Optionally, inspect a few examples (only if duplicates exist)
if (dup_count > 0) {
message("Found ", dup_count, " potential duplicates. Showing first few:")
merged_data %>%
group_by(across(all_of(keys))) %>%
filter(n() > 1) %>%
arrange(title, start_year) %>%
slice_head(n = 10)
} else {
message("No duplicate movies found based on title, year, and runtime.")
}
### Removing duplicates (keep version with highest votes) ----
movies_final_clean <- merged_data %>%
group_by(across(all_of(keys))) %>%
slice_max(votes, with_ties = FALSE) %>%
ungroup()
# Checking the duplicated data
### Checking for duplicates in merged data ----
# Define the keys for potential duplication
keys <- c("title", "start_year", "runtime_minutes")
# Count how many duplicate entries exist
dup_count <- sum(duplicated(select(merged_data, all_of(keys))))
dup_count
# Optionally, inspect a few examples (only if duplicates exist)
if (dup_count > 0) {
message("Found ", dup_count, " potential duplicates. Showing first few:")
merged_data %>%
group_by(across(all_of(keys))) %>%
filter(n() > 1) %>%
arrange(title, start_year) %>%
slice_head(n = 10)
} else {
message("No duplicate movies found based on title, year, and runtime.")
}
### Removing duplicates (keep version with highest votes) ----
movies_final_clean <- merged_data %>%
group_by(across(all_of(keys))) %>%
slice_max(votes, with_ties = FALSE) %>%
ungroup()
# Define the keys for potential duplication
keys <- c("title", "start_year", "runtime_minutes")
# Count how many duplicate entries exist
dup_count <- sum(duplicated(select(merged_data, all_of(keys))))
dup_count
# Optionally, inspect a few examples (only if duplicates exist)
if (dup_count > 0) {
message("Found ", dup_count, " potential duplicates. Showing first few:")
merged_data %>%
group_by(across(all_of(keys))) %>%
filter(n() > 1) %>%
arrange(title, start_year) %>%
slice_head(n = 10)
} else {
message("No duplicate movies found based on title, year, and runtime.")
}
keys <- c("title", "start_year", "runtime_minutes")
# Count how many duplicate entries exist
dup_count <- sum(duplicated(select(merged_data, all_of(keys))))
dup_count
# Extract duplicated rows for inspection
dups_rows <- merged_data %>%
mutate(is_dup = duplicated(select(., all_of(keys))) |
duplicated(select(., all_of(keys)), fromLast = TRUE)) %>%
View(dups_rows)
# Extract duplicated rows for inspection
dups_rows <- merged_data %>%
mutate(is_dup = duplicated(select(., all_of(keys))) |
duplicated(select(., all_of(keys)), fromLast = TRUE)) %>%
filter(is_dup) %>%
select(title, start_year, runtime_minutes, average_rating, votes) %>%
arrange(title, start_year, runtime_minutes)
View(dups_rows)
# Preview the first few duplicated observations
dups_rows %>% slice_head(n = 20)
keys <- c("title", "start_year", "runtime_minutes")
dup_count <- sum(duplicated(select(merged_data, all_of(keys))))
dup_count
duplicated_movies <- merged_data %>%
mutate(is_dup = duplicated(select(., all_of(keys))) |
duplicated(select(., all_of(keys)), fromLast = TRUE)) %>%
filter(is_dup) %>%
select(title, start_year, runtime_minutes, average_rating, votes) %>%
arrange(title, start_year, runtime_minutes)
View(duplicated_movies)
# Preview the first few duplicated observations
duplicated_movies %>% slice_head(n = 20)
# Count duplicate groups (titles that appear multiple times)
duplicate_summary <- merged_data %>%
count(across(all_of(keys)), sort = TRUE) %>%
filter(n > 1)
# Display top repeated movies
duplicate_summary %>% slice_head(n = 20)
# Count duplicate groups (titles that appear multiple times)
duplicate_summary <- merged_data %>%
count(across(all_of(keys)), sort = TRUE) %>%
filter(n > 1) %>% slice_head(n = 20)
duplicate_summary
# Checking the duplicated data
keys <- c("title", "start_year", "runtime_minutes")
dup_count <- sum(duplicated(select(merged_data, all_of(keys))))
dup_count
duplicated_movies <- merged_data %>%
mutate(is_duplicate = duplicated(select(., all_of(keys))) |
duplicated(select(., all_of(keys)), fromLast = TRUE)) %>%
filter(is_dup) %>%
select(title, start_year, runtime_minutes, average_rating, votes) %>%
arrange(title, start_year, runtime_minutes)
# Checking the duplicated data
keys <- c("title", "start_year", "runtime_minutes")
dup_count <- sum(duplicated(select(merged_data, all_of(keys))))
dup_count
duplicated_movies <- merged_data %>%
mutate(is_duplicate = duplicated(select(., all_of(keys))) |
duplicated(select(., all_of(keys)), fromLast = TRUE)) %>%
filter(is_duplicate) %>%
select(title, start_year, runtime_minutes, average_rating, votes) %>%
arrange(title, start_year, runtime_minutes)
# Count duplicate groups (titles that appear multiple times)
duplicate_summary <- merged_data %>%
count(across(all_of(keys)), sort = TRUE) %>%
filter(n > 1) %>% slice_head(n = 20)
duplicate_summary
movies_final_clean <- merged_data %>%
group_by(across(all_of(keys))) %>%
slice_max(votes, with_ties = FALSE) %>%   # keep movie with highest votes
ungroup()
movies_final_clean <- merged_data %>%
group_by(across(all_of(keys))) %>%
slice_max(votes, with_ties = FALSE) %>%   # keep movie with highest votes
ungroup()
### 3.4 Handling Duplicates ----
# Purpose: Retain only one record per movie (title, year, runtime) — the one with highest number of votes
movies_final_clean <- merged_data %>%
group_by(across(all_of(keys))) %>%
slice_max(votes, with_ties = FALSE) %>%   # keep movie with highest votes
ungroup()
# Check how many rows were removed
removed_duplicates <- nrow(merged_data) - nrow(movies_final_clean)
removed_duplicates
# Handling Duplicates - retaining only one record per movie, the one with highest number of votes
movies_deduplicated <- merged_data %>%
group_by(across(all_of(keys))) %>%
slice_max(votes, with_ties = FALSE) %>%   # keep movie with highest votes
ungroup()
sum(duplicated(select(movies_deduplicated, all_of(keys))))
colSums(is.na(movies_deduplicated[, c("runtime_minutes", "average_rating", "start_year", "title")]))
View(movies_deduplicated)
summary(movies_deduplicated)
## Handling missing data
colSums(is.na(movies_deduplicated[, c("runtime_minutes", "average_rating", "start_year", "title")]))
summary(movies_deduplicated)
movies_final_clean %>% movies_deduplicated
movies_final_clean <- movies_deduplicated
descriptives <- tibble(
Variable = c("runtime_minutes","average_rating","start_year"),
N        = c(sum(!is.na(movies_final_clean$runtime_minutes)),
sum(!is.na(movies_final_clean$average_rating)),
sum(!is.na(movies_final_clean$start_year))),
Missing  = c(sum(is.na(movies_final_clean$runtime_minutes)),
sum(is.na(movies_final_clean$average_rating)),
sum(is.na(movies_final_clean$start_year))),
Mean     = c(mean(movies_final_clean$runtime_minutes, na.rm = TRUE),
mean(movies_final_clean$average_rating,  na.rm = TRUE),
mean(movies_final_clean$start_year,      na.rm = TRUE)),
SD       = c(sd(movies_final_clean$runtime_minutes, na.rm = TRUE),
sd(movies_final_clean$average_rating,  na.rm = TRUE),
sd(movies_final_clean$start_year,      na.rm = TRUE)),
Min      = c(min(movies_final_clean$runtime_minutes, na.rm = TRUE),
min(movies_final_clean$average_rating,  na.rm = TRUE),
min(movies_final_clean$start_year,      na.rm = TRUE)),
Max      = c(max(movies_final_clean$runtime_minutes, na.rm = TRUE),
max(movies_final_clean$average_rating,  na.rm = TRUE),
max(movies_final_clean$start_year,      na.rm = TRUE)))
descriptives %>%
gt() %>%
tab_header(title = "Table 2. Descriptive Statistics") %>%
tab_options(column_labels.font.weight="bold")
## Handling missing data
colSums(is.na(movies_deduplicated[, c("runtime_minutes", "average_rating", "start_year", "title")]))
summary(movies_deduplicated)
movies_final_clean <- movies_deduplicated
LR1 <- lm(average_rating ~ runtime_minutes + start_year, data = movies_final_clean)
summary(LR1)
knitr::opts_chunk$set(
echo    = FALSE,
message = FALSE,
warning = FALSE,
fig.align = "center",
fig.width = 7, fig.height = 4, dpi = 180
)
options(tidyverse.quiet = TRUE)
need_pkgs <- c(
"tidyverse","data.table","readr","lubridate",
"knitr","kableExtra","broom"
)
# Optional (used only if you later add those features)
opt_pkgs <- c("ISOweek","zoo","janitor","gt")
missing <- setdiff(need_pkgs, rownames(installed.packages()))
if (length(missing)) {
stop(
sprintf("Please install missing packages before knitting: %s",
paste(missing, collapse = ", "))
)
}
invisible(lapply(need_pkgs, library, character.only = TRUE))
present_opt <- intersect(opt_pkgs, rownames(installed.packages()))
if (length(present_opt)) {
invisible(lapply(present_opt, library, character.only = TRUE))
}
## Data Loading
# Load IMDb title.basics data
title.basics <- fread("https://datasets.imdbws.com/title.basics.tsv.gz")
## Data Loading
# Load IMDb title.basics data
title.basics <- fread("https://datasets.imdbws.com/title.basics.tsv.gz")
knitr::opts_chunk$set(
echo    = FALSE,
message = FALSE,
warning = FALSE,
fig.align = "center",
fig.width = 7, fig.height = 4, dpi = 180
)
options(tidyverse.quiet = TRUE)
need_pkgs <- c(
"tidyverse","data.table","readr","lubridate",
"knitr","kableExtra","broom"
)
# Optional (used only if you later add those features)
opt_pkgs <- c("ISOweek","zoo","janitor","gt")
missing <- setdiff(need_pkgs, rownames(installed.packages()))
if (length(missing)) {
stop(
sprintf("Please install missing packages before knitting: %s",
paste(missing, collapse = ", "))
)
}
invisible(lapply(need_pkgs, library, character.only = TRUE))
present_opt <- intersect(opt_pkgs, rownames(installed.packages()))
if (length(present_opt)) {
invisible(lapply(present_opt, library, character.only = TRUE))
}
## Data Loading
# Load IMDb title.basics data
title.basics <- fread("https://datasets.imdbws.com/title.basics.tsv.gz")
knitr::opts_chunk$set(
echo    = FALSE,
message = FALSE,
warning = FALSE,
fig.align = "center",
fig.width = 7, fig.height = 4, dpi = 180
)
options(tidyverse.quiet = TRUE)
need_pkgs <- c(
"tidyverse","data.table","readr","lubridate",
"knitr","kableExtra","broom"
)
# Optional (used only if you later add those features)
opt_pkgs <- c("ISOweek","zoo","janitor","gt")
missing <- setdiff(need_pkgs, rownames(installed.packages()))
if (length(missing)) {
stop(
sprintf("Please install missing packages before knitting: %s",
paste(missing, collapse = ", "))
)
}
invisible(lapply(need_pkgs, library, character.only = TRUE))
present_opt <- intersect(opt_pkgs, rownames(installed.packages()))
if (length(present_opt)) {
invisible(lapply(present_opt, library, character.only = TRUE))
}
# Load IMDb title.basics data
title.basics <- fread("https://datasets.imdbws.com/title.basics.tsv.gz")
# Load IMDb title.ratings data
title.ratings <- fread("https://datasets.imdbws.com/title.ratings.tsv.gz")
# Load IMDb title.basics data
title.basics <- fread("https://datasets.imdbws.com/title.basics.tsv.gz")
title.basics <- fread("https://datasets.imdbws.com/title.basics.tsv.gz", method = "curl")
## Data Loading
install.packages("curl")
# Load IMDb title.basics data
title.basics <- fread("https://datasets.imdbws.com/title.basics.tsv.gz", method = "curl")
knitr::opts_chunk$set(
echo    = FALSE,
message = FALSE,
warning = FALSE,
fig.align = "center",
fig.width = 7, fig.height = 4, dpi = 180
)
options(tidyverse.quiet = TRUE)
need_pkgs <- c(
"tidyverse","data.table","readr","lubridate",
"knitr","kableExtra","broom"
)
# Optional (used only if you later add those features)
opt_pkgs <- c("ISOweek","zoo","janitor","gt")
missing <- setdiff(need_pkgs, rownames(installed.packages()))
if (length(missing)) {
stop(
sprintf("Please install missing packages before knitting: %s",
paste(missing, collapse = ", "))
)
}
invisible(lapply(need_pkgs, library, character.only = TRUE))
present_opt <- intersect(opt_pkgs, rownames(installed.packages()))
if (length(present_opt)) {
invisible(lapply(present_opt, library, character.only = TRUE))
}
## Data Loading
# Load IMDb title.basics data
title.basics <- fread("https://datasets.imdbws.com/title.basics.tsv.gz")
